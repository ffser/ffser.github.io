<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>mysql存储过程 | willhao</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="我们平时操作数据库语言sql语句在执行的时候需要先编译，然后执行，而存储过程是一组为了完成特定功能的sql语句集。经过编译后存储在数据库中，只需通过指定存储过程的名字并给定参数调用它。存储过程只在mysql5.0之后才支持。">
<meta property="og:type" content="article">
<meta property="og:title" content="mysql存储过程">
<meta property="og:url" content="http://willhao.com/2016/03/05/mysql-procedure/index.html">
<meta property="og:site_name" content="willhao">
<meta property="og:description" content="我们平时操作数据库语言sql语句在执行的时候需要先编译，然后执行，而存储过程是一组为了完成特定功能的sql语句集。经过编译后存储在数据库中，只需通过指定存储过程的名字并给定参数调用它。存储过程只在mysql5.0之后才支持。">
<meta property="og:updated_time" content="2016-03-05T12:22:40.017Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="mysql存储过程">
<meta name="twitter:description" content="我们平时操作数据库语言sql语句在执行的时候需要先编译，然后执行，而存储过程是一组为了完成特定功能的sql语句集。经过编译后存储在数据库中，只需通过指定存储过程的名字并给定参数调用它。存储过程只在mysql5.0之后才支持。">
  
    <link rel="alternative" href="/atom.xml" title="willhao" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
      <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css" type="text/css">
  
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
  
      <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  
  <script>
      var yiliaConfig = {
          fancybox: true,
          animate: true,
          isHome: false,
          isPost: true,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false
      }
  </script>
  
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            
            <img lazy-src="/img/avatar.png" class="js-avatar">
            
        </a>

        <hgroup>
          <h1 class="header-author"><a href="/">陈豪</a></h1>
        </hgroup>

        
        <p class="header-subtitle">努力成为全栈工程师</p>
        
                


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <li id="Email"><a class="Email" target="_blank" href="mailto:250248410@qq.com" title="Email"></a></li>
                            
                                <li id="GitHub"><a class="GitHub" target="_blank" href="https://github.com/ffser/" title="GitHub"></a></li>
                            
                                <li id="RSS"><a class="RSS" target="_blank" href="/atom.xml" title="RSS"></a></li>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <a href="/tags/github/" style="font-size: 10px;">github</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/博客/" style="font-size: 10px;">博客</a> <a href="/tags/存储过程/" style="font-size: 10px;">存储过程</a> <a href="/tags/设计模式/" style="font-size: 10px;">设计模式</a> <a href="/tags/闭包/" style="font-size: 10px;">闭包</a> <a href="/tags/面向对象/" style="font-size: 10px;">面向对象</a>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">专注于全栈</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">陈豪</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                
                    <img lazy-src="/img/avatar.png" class="js-avatar">
                
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">陈豪</a></h1>
            </hgroup>
            
            <p class="header-subtitle">努力成为全栈工程师</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <li id="Email"><a class="Email" target="_blank" href="mailto:250248410@qq.com" title="Email"></a></li>
                            
                                <li id="GitHub"><a class="GitHub" target="_blank" href="https://github.com/ffser/" title="GitHub"></a></li>
                            
                                <li id="RSS"><a class="RSS" target="_blank" href="/atom.xml" title="RSS"></a></li>
                            
                        </ul>
            </nav>
        </header>                
    </div>
</nav>
      <div class="body-wrap"><article id="post-mysql-procedure" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/05/mysql-procedure/" class="article-date">
      <time datetime="2016-03-05T03:35:01.000Z" itemprop="datePublished">2016-03-05</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      mysql存储过程
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        

        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/">mysql</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/存储过程/">存储过程</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>我们平时操作数据库语言sql语句在执行的时候需要先编译，然后执行，而存储过程是一组为了完成特定功能的sql语句集。经过编译后存储在数据库中，只需通过指定存储过程的名字并给定参数调用它。存储过程只在mysql5.0之后才支持。<br><a id="more"></a></p>
<h2 id="存储过程的优势"><a href="#存储过程的优势" class="headerlink" title="存储过程的优势"></a>存储过程的优势</h2><h3 id="1-存储过程使sql语言的功能更强更灵活。"><a href="#1-存储过程使sql语言的功能更强更灵活。" class="headerlink" title="1.存储过程使sql语言的功能更强更灵活。"></a>1.存储过程使sql语言的功能更强更灵活。</h3><p>通过语句编写，可以灵活的完成更加复杂的判断和复杂的运算。</p>
<h3 id="2-和程序代码分离"><a href="#2-和程序代码分离" class="headerlink" title="2.和程序代码分离"></a>2.和程序代码分离</h3><p>使用者不用去理会存储过程的具体实现，专注于其他逻辑，只需调用即可。</p>
<h3 id="3-执行速度更快，效率更高"><a href="#3-执行速度更快，效率更高" class="headerlink" title="3.执行速度更快，效率更高"></a>3.执行速度更快，效率更高</h3><p>调用一次存储过程，比多次调用多个sql语句，效率肯定更高。存储过程是预编译的。而其他sql每次多要编译后在执行。</p>
<h3 id="4-减少网络传输"><a href="#4-减少网络传输" class="headerlink" title="4.减少网络传输"></a>4.减少网络传输</h3><p>存储过程调用在网络传输中是调用语句。不必传输大量的sql语句。</p>
<h3 id="5-更加安全"><a href="#5-更加安全" class="headerlink" title="5.更加安全"></a>5.更加安全</h3><p>数据库管理人员可以为存储过程分配权限。避免非授权用户的访问。</p>
<h2 id="存储过程的实现"><a href="#存储过程的实现" class="headerlink" title="存储过程的实现"></a>存储过程的实现</h2><h3 id="存储过程的创建"><a href="#存储过程的创建" class="headerlink" title="存储过程的创建"></a>存储过程的创建</h3><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; DELIMITER <span class="comment">//</span></span><br><span class="line">mysql&gt; CREATE <span class="function"><span class="keyword">PROCEDURE</span> <span class="title">test</span><span class="params">(<span class="keyword">OUT</span> s int)</span></span><br><span class="line">		-&gt; <span class="title">BEGIN</span></span><br><span class="line">		-&gt; <span class="title">SELECT</span> <span class="title">COUNT</span><span class="params">(*)</span> <span class="title">INTO</span> <span class="title">s</span> <span class="title">FROM</span> <span class="title">test</span>;</span> </span><br><span class="line">		-&gt; <span class="keyword">END</span></span><br><span class="line">		-&gt; <span class="comment">//</span></span><br><span class="line">mysql&gt; DELIMITER ;</span><br></pre></td></tr></table></figure>
<p>1.DELIMITER //,重新定义mysql的分隔符，使”;”成为存储过程语句中的一部分。<br>2.用BEGIN,开始，实现完过程，END结束，分隔符//自动执行。<br>3.创建完，改回DELIMITER。<br>饭一口一口吃，更详细的介绍后面再提。既然创建了存储过程，那我们怎么知道到底创建成功没有，所以先看看如何查看存储过程</p>
<h3 id="查看存储过程"><a href="#查看存储过程" class="headerlink" title="查看存储过程"></a>查看存储过程</h3><p>1.<br><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show name <span class="keyword">from</span> mysql.<span class="keyword">proc</span> where db='数据库名字';</span><br></pre></td></tr></table></figure></p>
<p>2.<br><figure class="highlight cal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show <span class="function"><span class="keyword">procedure</span> <span class="title">status</span> <span class="title">where</span> <span class="title">db</span>='数据库名字';</span></span><br></pre></td></tr></table></figure></p>
<p>3.<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">select</span> routine_name <span class="keyword">from</span> information_schema.routines <span class="keyword">where</span> routine_schema=<span class="string">'数据库名字'</span>;</span><br></pre></td></tr></table></figure></p>
<p>然后可以看到我们之前定义的test存储过程的名字。只是知道名字。要是忘记了之前定义的具体实现怎么办呢。所以我们必须有个方法来查看存储过程的具体实现代码。<br><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show <span class="keyword">create</span> <span class="function"><span class="keyword">procedure</span> <span class="title">test</span></span></span><br></pre></td></tr></table></figure></p>
<p>这样就可以查看存储过程test的具体实现代码。</p>
<h3 id="修改和删除存储过程"><a href="#修改和删除存储过程" class="headerlink" title="修改和删除存储过程"></a>修改和删除存储过程</h3><p>如果发现存储过程实现逻辑有误，需要更改怎么办：<br>只能修改他们的权限，目前MYSQL还不提供对已存在的存储过程和函数代码的修改：<br>alter procedure<br>所以只能这样：<br>1.删除存储过程<br><figure class="highlight cal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop <span class="function"><span class="keyword">procedure</span> <span class="title">test</span></span></span><br></pre></td></tr></table></figure></p>
<p>2.然后重新创建存储过程</p>
<h2 id="存储过程具体实现"><a href="#存储过程具体实现" class="headerlink" title="存储过程具体实现"></a>存储过程具体实现</h2><h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><p>myql存储过程一共有3中参数形式.IN,OUT,INOUT<br>CREATE PROCEDURE([[IN |OUT |INOUT ] 参数名 数据类形…])<br>1.IN 输入参数：表示参数值必须在调用存储过程是指定，在存储过程中修改该参数的值不能被返回，为默认值<br>也就是说传入的IN型参数只能在存储过程这个作用域里面被修改。出了这个作用域。还是默认值。<br>更简单的理解就是在存储过程内部只能读取到参数。修改的是参数的一个副本。不会影响到参数本身。<br>2.OUT 输出型参数：该值可以再存储过程内部被改变，并可返回，<br>也就是不管在外部定义成什么样的值，在传入存储过程内部时，该值初始值多是null，但是可以在存储过年内部被修改成其他值，然后返回并且能够改变外部变量的值。<br>3.INOUT 输入输出参数:调用时指定，并且可被改变和返回。这个就相当于前面2个的结合。</p>
<h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p>1.变量定义<br>DECLARE variable_name [,variable_name…] datatype [DEFAULT value];<br>其中，datatype为MySQL的数据类型，如:int, float, date, varchar(length)<br>DECLARE l_int int unsigned default  3000000;<br>DECLARE l_varchar varchar(255) default ‘’;<br>2.变量赋值<br>SET 变量名 = 表达式值 [,variable_name = expression …]<br>3.用户变量<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">mysql</span> &gt; <span class="built_in">select</span> <span class="string">'willhao'</span> into <span class="variable">@w</span>;</span><br><span class="line"><span class="title">mysql</span> &gt; <span class="built_in">select</span> <span class="variable">@w</span>;</span><br><span class="line"><span class="title">mysql</span> &gt; set <span class="variable">@z</span> = <span class="string">'test'</span>;</span><br><span class="line"><span class="title">mysql</span> &gt; <span class="built_in">select</span> <span class="variable">@z</span>;</span><br></pre></td></tr></table></figure></p>
<p>客户端关闭 用户变量就自动消失<br>ps:<br>用户变量名一般以@开头<br>滥用用户变量会导致程序难以理解及管理<br>注释：双模杠：–   ：–name存储过程名</p>
<h3 id="MySQL存储过程的控制语句"><a href="#MySQL存储过程的控制语句" class="headerlink" title="MySQL存储过程的控制语句"></a>MySQL存储过程的控制语句</h3><p>1.变量作用域<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">begin</span></span><br><span class="line">	···</span><br><span class="line">	<span class="keyword">begin</span></span><br><span class="line">		···</span><br><span class="line">	<span class="keyword">end</span>;</span></span><br><span class="line"><span class="operator"><span class="keyword">end</span>;</span></span><br></pre></td></tr></table></figure></p>
<p>2.条件语句<br>if-then-else<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ··· <span class="keyword">then</span> </span><br><span class="line">···</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">if</span>;</span><br><span class="line"><span class="keyword">if</span> ··· <span class="keyword">then</span> </span><br><span class="line">···</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"> ···</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">if</span>;</span><br></pre></td></tr></table></figure></p>
<p>case语句<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> ···</span><br><span class="line"><span class="keyword">when</span> ··· <span class="keyword">then</span></span><br><span class="line">···</span><br><span class="line"><span class="keyword">when</span> ··· <span class="keyword">then</span></span><br><span class="line">···</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">···</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">case</span>;</span><br></pre></td></tr></table></figure></p>
<p>3.循环语句<br>while····end while<br><figure class="highlight cal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> ··· <span class="keyword">do</span></span><br><span class="line">···</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">while</span>;</span><br></pre></td></tr></table></figure></p>
<p>repeat····end repeat<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">repeat</span></span><br><span class="line">···</span><br><span class="line"><span class="keyword">until</span> ···</span><br><span class="line"><span class="function"><span class="keyword">end</span> <span class="title">repaet</span>;</span></span><br></pre></td></tr></table></figure></p>
<p>loop····end loop<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">LOOP_LABLE</span>:loop </span><br><span class="line">···</span><br><span class="line">leave LOOP_LABLE;</span><br></pre></td></tr></table></figure></p>
<p>LABLES标记<br>4.iterare迭代<br>ITERATE</p>
<h2 id="存储过程与函数"><a href="#存储过程与函数" class="headerlink" title="存储过程与函数"></a>存储过程与函数</h2><ol>
<li>只能说是看各自的习惯的,用procedure可以实现的,大部分用函数都可以的,所以有些package中函数的实现一个，过程的实现一个。<br>2.考虑是使用函数还是使用存储过程可以根据以下方面：<br>从参数的返回情况来看：如果返回多个参数值最好使用存储过程，如果只有一个返回值的话可以使用函数；<br>从调用情况来看：</li>
</ol>
<p>(1)如果在SQL语句（DML或SELECT）中调用的话一定是存储函数或存储的封装函数不可以是存储过程，但调用存储函数的时候还有好多限制以及函数的纯度等级的问题，你可以参考《ORACLE 9I PL\SQL程序设计》（机械工业出版社）；<br>(2)如果是在过程化语句中调用的话，就要看你要实现什么样的功能。函数一般情况下是用来计算并返回一个计算结果而存储过程一般是用来完成特定的数据操作（比如修改、插入数据库表或执行某些DDL语句等等），所以虽然他们的语法上很相似但用户在使用他们的时候所需要完成的功能大部分情况下是不同的。</p>
<ol>
<li>让我来简单的说PROCEDURE可以返回值,也可以做一件事,比如几个TABLE之间的数据转来转去,而FUNCTION一定要有返回值,还只能返回一个…..</li>
</ol>
<p>4.三点与存储过程不同的地方：<br>a，必须要一个RETURNS语句来定义返回值类型<br>b，不能指定参数的IN、OUT或INOUT修饰符，所有参数隐式的为IN<br>c，Function体必须包含RETURN语句来终结Function执行并返回指定的结果给调用者 </p>
<h2 id="MySQL存储过程的基本函数"><a href="#MySQL存储过程的基本函数" class="headerlink" title="MySQL存储过程的基本函数"></a>MySQL存储过程的基本函数</h2><h3 id="字符串类"><a href="#字符串类" class="headerlink" title="字符串类"></a>字符串类</h3><p>CHARSET(str) //返回字串字符集<br>CONCAT (string2 [,… ]) //连接字串<br>INSTR (string ,substring ) //返回substring首次在string中出现的位置,不存在返回0<br>LCASE (string2 ) //转换成小写<br>LEFT (string2 ,length ) //从string2中的左边起取length个字符<br>LENGTH (string ) //string长度<br>LOAD_FILE (file_name ) //从文件读取内容<br>LOCATE (substring , string [,start_position ] ) 同INSTR,但可指定开始位置<br>LPAD (string2 ,length ,pad ) //重复用pad加在string开头,直到字串长度为length<br>LTRIM (string2 ) //去除前端空格<br>REPEAT (string2 ,count ) //重复count次<br>REPLACE (str ,search_str ,replace_str ) //在str中用replace_str替换search_str<br>RPAD (string2 ,length ,pad) //在str后用pad补充,直到长度为length<br>RTRIM (string2 ) //去除后端空格<br>STRCMP (string1 ,string2 ) //逐字符比较两字串大小,<br>SUBSTRING (str , position [,length ]) //从str的position开始,取length个字符,</p>
<h3 id="数学类"><a href="#数学类" class="headerlink" title="数学类"></a>数学类</h3><p>ABS (number2 ) //绝对值<br>BIN (decimal_number ) //十进制转二进制<br>CEILING (number2 ) //向上取整<br>CONV(number2,from_base,to_base) //进制转换<br>FLOOR (number2 ) //向下取整<br>FORMAT (number,decimal_places ) //保留小数位数<br>HEX (DecimalNumber ) //转十六进制<br>注：HEX()中可传入字符串，则返回其ASC-11码，如HEX(‘DEF’)返回4142143<br>也可以传入十进制整数，返回其十六进制编码，如HEX(25)返回19<br>LEAST (number , number2 [,..]) //求最小值<br>MOD (numerator ,denominator ) //求余<br>POWER (number ,power ) //求指数<br>RAND([seed]) //随机数<br>ROUND (number [,decimals ]) //四舍五入,decimals为小数位数]</p>
<h3 id="日期时间类"><a href="#日期时间类" class="headerlink" title="日期时间类"></a>日期时间类</h3><p>ADDTIME (date2 ,time_interval ) //将time_interval加到date2<br>CONVERT_TZ (datetime2 ,fromTZ ,toTZ ) //转换时区<br>CURRENT_DATE ( ) //当前日期<br>CURRENT_TIME ( ) //当前时间<br>CURRENT_TIMESTAMP ( ) //当前时间戳<br>DATE (datetime ) //返回datetime的日期部分<br>DATE_ADD (date2 , INTERVAL d_value d_type ) //在date2中加上日期或时间<br>DATE_FORMAT (datetime ,FormatCodes ) //使用formatcodes格式显示datetime<br>DATE_SUB (date2 , INTERVAL d_value d_type ) //在date2上减去一个时间<br>DATEDIFF (date1 ,date2 ) //两个日期差<br>DAY (date ) //返回日期的天<br>DAYNAME (date ) //英文星期<br>DAYOFWEEK (date ) //星期(1-7) ,1为星期天<br>DAYOFYEAR (date ) //一年中的第几天<br>EXTRACT (interval_name FROM date ) //从date中提取日期的指定部分<br>MAKEDATE (year ,day ) //给出年及年中的第几天,生成日期串<br>MAKETIME (hour ,minute ,second ) //生成时间串<br>MONTHNAME (date ) //英文月份名<br>NOW ( ) //当前时间<br>SEC_TO_TIME (seconds ) //秒数转成时间<br>STR_TO_DATE (string ,format ) //字串转成时间,以format格式显示<br>TIMEDIFF (datetime1 ,datetime2 ) //两个时间差<br>TIME_TO_SEC (time ) //时间转秒数]<br>WEEK (date_time [,start_of_week ]) //第几周<br>YEAR (datetime ) //年份<br>DAYOFMONTH(datetime) //月的第几天<br>HOUR(datetime) //小时<br>LAST_DAY(date) //date的月的最后日期<br>MICROSECOND(datetime) //微秒<br>MONTH(datetime) //月<br>MINUTE(datetime) //分返回符号,正负或0<br>SQRT(number2) //开平方</p>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2016/03/05/mysql-procedure/">mysql存储过程</a></p>
        <p><span>文章作者:</span><a href="/" title="访问 陈豪 的个人博客">陈豪</a></p>
        <p><span>发布时间:</span>2016年03月05日 - 11时35分</p>
        <p><span>最后更新:</span>2016年03月05日 - 20时22分</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2016/03/05/mysql-procedure/" title="mysql存储过程">http://willhao.com/2016/03/05/mysql-procedure/</a>
            <span class="copy-path" data-clipboard-text="原文: http://willhao.com/2016/03/05/mysql-procedure/　　作者: 陈豪" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script src="/js/clipboard.min.js"></script>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" title="中国大陆 (CC BY-NC-SA 3.0 CN)" target = "_blank">"署名-非商用-相同方式共享 3.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2016/03/03/nginx/">
                    nginx
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#存储过程的优势"><span class="toc-number">1.</span> <span class="toc-text">存储过程的优势</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-存储过程使sql语言的功能更强更灵活。"><span class="toc-number">1.1.</span> <span class="toc-text">1.存储过程使sql语言的功能更强更灵活。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-和程序代码分离"><span class="toc-number">1.2.</span> <span class="toc-text">2.和程序代码分离</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-执行速度更快，效率更高"><span class="toc-number">1.3.</span> <span class="toc-text">3.执行速度更快，效率更高</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-减少网络传输"><span class="toc-number">1.4.</span> <span class="toc-text">4.减少网络传输</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-更加安全"><span class="toc-number">1.5.</span> <span class="toc-text">5.更加安全</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#存储过程的实现"><span class="toc-number">2.</span> <span class="toc-text">存储过程的实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#存储过程的创建"><span class="toc-number">2.1.</span> <span class="toc-text">存储过程的创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查看存储过程"><span class="toc-number">2.2.</span> <span class="toc-text">查看存储过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#修改和删除存储过程"><span class="toc-number">2.3.</span> <span class="toc-text">修改和删除存储过程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#存储过程具体实现"><span class="toc-number">3.</span> <span class="toc-text">存储过程具体实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#参数"><span class="toc-number">3.1.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#变量"><span class="toc-number">3.2.</span> <span class="toc-text">变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL存储过程的控制语句"><span class="toc-number">3.3.</span> <span class="toc-text">MySQL存储过程的控制语句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#存储过程与函数"><span class="toc-number">4.</span> <span class="toc-text">存储过程与函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL存储过程的基本函数"><span class="toc-number">5.</span> <span class="toc-text">MySQL存储过程的基本函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#字符串类"><span class="toc-number">5.1.</span> <span class="toc-text">字符串类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数学类"><span class="toc-number">5.2.</span> <span class="toc-text">数学类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#日期时间类"><span class="toc-number">5.3.</span> <span class="toc-text">日期时间类</span></a></li></ol></li></ol>
</div>
<style>
    .left-col .switch-btn {
        display: none;
    }
    .left-col .switch-area {
        display: none;
    }
</style>

<input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script>
    var valueHide = "隐藏目录";
    var valueShow = "显示目录";

    if ($(".left-col").is(":hidden")) {
        $("#tocButton").attr("value", valueShow);
    }

    $("#tocButton").click(function() {
        if ($("#toc").is(":hidden")) {
            $("#tocButton").attr("value", valueHide);
            $("#toc").slideDown(320);
            $(".switch-btn, .switch-area").fadeOut(300);
        }
        else {
            $("#tocButton").attr("value", valueShow);
            $("#toc").slideUp(350);
            $(".switch-btn, .switch-area").fadeIn(500);
        }
    })

    if ($(".toc").length < 1) {
        $("#toc, #tocButton").hide();
        $(".switch-btn, .switch-area").show();
    }
</script>




    <div class="share">
    <div class="bdsharebuttonbox">
    <a href="#" class="bds_more" data-cmd="more"></a>
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
    <a href="#" class="bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
    <a href="#" class="bds_copy" data-cmd="copy" title="复制网址"></a>
    <a href="#" class="bds_mail" data-cmd="mail" title="通过邮件分享"></a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
    </div>
    <script>
        window._bd_share_config={
            "common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
    </script>
</div>



    
      <div class="duoshuo" id="comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="2016/03/05/mysql-procedure/" data-title="mysql存储过程" data-url="http://willhao.com/2016/03/05/mysql-procedure/"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:"willhao"};
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
    </script>
    <!-- 多说公共JS代码 end -->
</div>

    




    <div class="scroll" id="post-nav-button">
        
            <a href="/" title="回到主页"><i class="fa fa-home"></i></a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2016/03/03/nginx/" title="下一篇: nginx">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/03/05/mysql-procedure/">mysql存储过程</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/03/nginx/">nginx</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/02/design-patterns/">设计模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/02/javascript-closure/">javascript匿名函数和闭包</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/28/javascript-object/">javascript的面向对象</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/27/start-github-blog/">如何建立github个人博客</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/26/hello-world/">Hello World</a></li></ul>
    <script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
    <script>
        $(".post-list").addClass("toc-article");
        $(".post-list-item a").attr("target","_blank");
        $("#post-nav-button > a:nth-child(2)").click(function() {
            $(".fa-bars, .fa-times").toggle();
            $(".post-list").toggle(300);
            if ($(".toc").length > 0) {
                $("#toc, #tocButton").toggle(200, function() {
                    if ($(".switch-area").is(":visible")) {
                        $("#toc, .switch-btn, .switch-area").toggle();
                        $("#tocButton").attr("value", valueHide);
                        }
                    })
            }
            else {
                $(".switch-btn, .switch-area").fadeToggle(300);
            }
        })
    </script>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                &copy; 2016 陈豪
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的静态博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减双栏 Hexo 博客主题">Yelee</a> by MOxFIVE
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" >本站到访数: 
                            <span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>, </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit">本页阅读量: 
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>




<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>

<script>
    $(document).ready(function() {
        if ($("#comments").length < 1) {
            $("#scroll > a:nth-child(2)").hide();
        };
    })
</script>


<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>